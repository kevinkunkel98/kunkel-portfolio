---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry }
  }));
}

const { entry } = Astro.props as { entry: CollectionEntry<'blog'> };
const { Content } = await entry.render();

function formatDate(date: Date) {
  return new Date(date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

// Get reading time estimate
function getReadingTime(content: string) {
  const wordsPerMinute = 200;
  const words = content.split(/\s+/).length;
  const minutes = Math.ceil(words / wordsPerMinute);
  return minutes;
}
---

<BaseLayout title={entry.data.title} description={entry.data.description}>
  <!-- Terminal Background -->
  <div class="min-h-screen bg-gradient-to-b from-black to-slate-900">
    <article class="max-w-4xl mx-auto px-3 sm:px-6 lg:px-8 py-6 sm:py-12">
      <!-- Article Header -->
      <header class="mb-8 sm:mb-12">
        <!-- Terminal Breadcrumb -->
        <nav class="mb-4 sm:mb-6 font-mono overflow-x-auto">
          <div class="text-xs sm:text-sm text-gray-400 whitespace-nowrap">
            <span class="text-blue-400">~/kevin-kunkel $</span>
            <span class="text-green-400">cd</span>
            <a href="/" class="hover:text-white transition-colors">/home</a>
            <span class="text-green-400">/</span>
            <a href="/blog" class="hover:text-white transition-colors">blog</a>
            <span class="text-green-400">/</span>
            <span class="text-white break-all">{entry.slug}</span>
          </div>
        </nav>

        <!-- Hero Image -->
        {entry.data.heroImage && (
          <div class="mb-6 sm:mb-8 border border-gray-700/50 rounded-lg overflow-hidden">
            <img
              src={entry.data.heroImage}
              alt={entry.data.title}
              class="w-full h-48 sm:h-64 md:h-96 object-cover opacity-80"
            />
          </div>
        )}

        <!-- Terminal File Header -->
        <div class="bg-black/60 backdrop-blur-sm border border-gray-700/50 rounded-lg p-4 sm:p-6 mb-6 sm:mb-8 font-mono">
          <div class="text-green-400 text-sm sm:text-lg mb-2 overflow-x-auto">
            <span class="text-blue-400">$</span> <span class="whitespace-nowrap">cat ./{entry.slug}.md</span>
          </div>
          <h1 class="text-xl sm:text-2xl md:text-4xl font-bold text-white mb-3 sm:mb-4 leading-tight">
            {entry.data.title}
          </h1>

          <p class="text-sm sm:text-base text-gray-300 mb-4 sm:mb-6 leading-relaxed">
            {entry.data.description}
          </p>

          <!-- File Meta -->
          <div class="flex flex-col gap-3 sm:gap-4 pb-4 border-b border-gray-700/50">
            <div class="flex items-center gap-2 text-xs sm:text-sm overflow-x-auto">
              <span class="text-gray-400 whitespace-nowrap">
                <span class="text-blue-400">$</span> stat {entry.slug}.md
              </span>
            </div>
            <div class="flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-400">
              <span class="px-2 py-1 bg-green-400/10 border border-green-400/30 text-green-400 whitespace-nowrap">
                {entry.data.category}
              </span>

              <time class="whitespace-nowrap">
                <span class="hidden sm:inline">Modified: </span>{formatDate(entry.data.pubDate)}
              </time>

              <span class="whitespace-nowrap">
                <span class="hidden sm:inline">Size: </span>~{getReadingTime(entry.body)} min
              </span>
            </div>

            {entry.data.tags && (
              <div class="flex flex-wrap gap-1.5 sm:gap-2">
                {entry.data.tags.map((tag) => (
                  <span class="px-2 py-1 text-xs text-blue-400 bg-blue-400/10 border border-blue-400/30 whitespace-nowrap">
                    #{tag}
                  </span>
                ))}
              </div>
            )}
          </div>
        </div>
    </header>

      <!-- Article Content -->
      <div class="bg-black/20 backdrop-blur-sm border border-gray-700/30 rounded-lg p-4 sm:p-6 md:p-8 prose prose-sm sm:prose-base lg:prose-lg prose-invert max-w-none overflow-x-hidden">
        <Content />
      </div>

      <!-- Terminal Footer -->
      <footer class="mt-8 sm:mt-12 pt-6 sm:pt-8 border-t border-gray-700/50 font-mono">
        <!-- Terminal Commands Section -->
        <div class="mb-6 sm:mb-8">
          <div class="text-green-400 mb-3 sm:mb-4 text-sm sm:text-base overflow-x-auto">
            <span class="text-blue-400">$</span> <span class="whitespace-nowrap">share --social {entry.slug}</span>
          </div>
          <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
            <a
              href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(entry.data.title)}&url=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center px-3 py-2 text-xs sm:text-sm bg-blue-500/20 border border-blue-500/50 text-blue-400 hover:text-white hover:bg-blue-500/40 transition-all whitespace-nowrap"
            >
              ./twitter --post
            </a>

            <a
              href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center px-3 py-2 text-xs sm:text-sm bg-blue-700/20 border border-blue-700/50 text-blue-400 hover:text-white hover:bg-blue-700/40 transition-all whitespace-nowrap"
            >
              ./linkedin --share
            </a>
          </div>
        </div>

        <!-- Navigation Commands -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-8">
          <div>
            <a
              href="/blog"
              class="inline-flex items-center text-green-400 hover:text-green-300 transition-colors text-sm sm:text-base"
            >
              <span class="text-blue-400">$</span> cd ../
            </a>
          </div>

          <div class="sm:text-right">
            <a
              href="/contact"
              class="inline-flex items-center text-green-400 hover:text-green-300 transition-colors text-sm sm:text-base"
            >
              <span class="text-blue-400">$</span> ./contact --kevin
            </a>
          </div>
        </div>
      </footer>
    </article>
  </div>
</BaseLayout>


